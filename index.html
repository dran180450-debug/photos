<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlashDrive | Master Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { background: #020617; color: white; height: 100vh; font-family: 'Inter', sans-serif; overflow: hidden; }
        .glass { background: rgba(255, 255, 255, 0.02); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.05); }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(59, 130, 246, 0.5); border-radius: 10px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .spinner { width: 16px; height: 16px; border: 2px solid rgba(255,255,255,0.1); border-top-color: #3b82f6; border-radius: 50%; animation: spin 0.8s linear infinite; }
    </style>
</head>
<body class="flex flex-col md:flex-row">

    <div id="masterListOverlay" class="hidden fixed inset-0 z-[500] bg-slate-950/95 backdrop-blur-2xl p-6 md:p-20 overflow-y-auto custom-scrollbar">
        <div class="max-w-4xl mx-auto">
            <div class="flex justify-between items-end mb-12 border-b border-white/5 pb-8">
                <div>
                    <h2 class="text-5xl font-black italic text-blue-500 uppercase tracking-tighter">System Folders</h2>
                    <p class="text-slate-500 text-[10px] font-bold uppercase mt-2 tracking-widest">Parent ID: 1MIn-XpTSlOG...G1tsW</p>
                </div>
                <button onclick="toggleMasterList()" class="bg-white/5 hover:bg-white/10 px-8 py-3 rounded-2xl font-black uppercase text-xs transition-all">Close</button>
            </div>
            <div class="glass rounded-[2.5rem] overflow-hidden border border-white/10">
                <table class="w-full text-left border-collapse">
                    <thead class="bg-white/[0.03] text-[10px] uppercase font-black tracking-widest text-slate-500">
                        <tr>
                            <th class="p-8">Folder / Album Name</th>
                            <th class="p-8 text-right">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="masterTableBody" class="text-sm"></tbody>
                </table>
            </div>
        </div>
    </div>

    <aside class="w-full md:w-[380px] h-screen glass border-r border-white/5 flex flex-col z-20">
        <div class="p-8 border-b border-white/5">
            <h1 class="text-3xl font-black italic text-blue-500 tracking-tighter uppercase mb-2">âš¡FlashDrive</h1>
            <div id="album-status" class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">No Active Album</div>
        </div>

        <div id="chat-box" class="flex-1 overflow-y-auto p-6 space-y-4 custom-scrollbar"></div>

        <div class="p-6 bg-slate-900/50 border-t border-white/5">
            <button onclick="adminLogin()" id="adminBtn" class="w-full py-4 rounded-2xl border border-white/5 text-[10px] font-black uppercase tracking-widest hover:bg-white/5 transition-all text-slate-400">ðŸ”’ System Master</button>
        </div>
    </aside>

    <main class="flex-1 h-screen flex flex-col p-6 md:p-12 overflow-hidden">
        <header class="flex justify-between items-center mb-10">
            <div id="album-title" class="text-4xl font-black uppercase italic tracking-tighter text-white/20">Select Album</div>
            <button onclick="document.getElementById('fileInput').click()" class="bg-blue-600 hover:bg-blue-500 text-white px-10 py-4 rounded-[1.5rem] font-black text-xs uppercase shadow-2xl shadow-blue-500/20 transition-all">Upload Photo</button>
            <input type="file" id="fileInput" class="hidden" accept="image/*">
        </header>

        <div id="view-feed" class="flex-1 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 overflow-y-auto custom-scrollbar"></div>
    </main>

    <div id="uploadToast" class="fixed bottom-10 right-10 z-[600] hidden">
        <div class="glass px-6 py-4 rounded-2xl flex items-center gap-4 border-blue-500/30">
            <div class="spinner"></div><span class="text-[10px] font-black text-blue-400 uppercase tracking-widest">Syncing with Drive...</span>
        </div>
    </div>

    <script>
        const firebaseConfig = { 
            apiKey: "AIzaSyBnIdsSY3DOvz4Q8lojZqUyndpG3ldnPc8",
            databaseURL: "https://photos-a5dfc-default-rtdb.firebaseio.com",
            projectId: "photos-a5dfc",
            appId: "1:964574526842:web:9f119aa6eebc94b0e16ac3"
        };
        const GAS_URL = "https://script.google.com/macros/s/AKfycbyjLFyb0FD2dbSUFA7yalfG9NQemMA3Qy2D6Xg_daqN575hxf9xB1ztmCo-Vw-g9_o/exec"; 
        const MASTER_PASS = "admin1988";

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const urlParams = new URLSearchParams(window.location.search);
        let albumId = urlParams.get('id');
        let myName = "Admin-" + Math.floor(Math.random() * 99);

        if (albumId) {
            document.getElementById('album-title').innerText = albumId;
            document.getElementById('album-title').classList.remove('text-white/20');
            document.getElementById('album-status').innerText = "Live: " + albumId;
            initGallery();
        }

        function adminLogin() {
            const p = prompt("Master Password:");
            if (p === MASTER_PASS) toggleMasterList();
        }

        async function toggleMasterList() {
            const overlay = document.getElementById('masterListOverlay');
            overlay.classList.toggle('hidden');
            if (!overlay.classList.contains('hidden')) {
                const tbody = document.getElementById('masterTableBody');
                tbody.innerHTML = `<tr><td colspan="2" class="p-20 text-center text-[10px] font-black uppercase text-slate-500 animate-pulse tracking-widest">Accessing Google Drive API...</td></tr>`;
                
                try {
                    const res = await fetch(GAS_URL);
                    const folders = await res.json();
                    tbody.innerHTML = "";
                    folders.forEach(f => {
                        const row = document.createElement('tr');
                        row.className = "border-t border-white/5 hover:bg-white/[0.01]";
                        row.innerHTML = `
                            <td class="p-8 font-black text-white uppercase italic text-lg tracking-tighter">${f.name}</td>
                            <td class="p-8 text-right">
                                <button onclick="window.location.search='?id=${f.name}'" class="bg-blue-600 px-6 py-3 rounded-xl text-[10px] font-black uppercase transition-all shadow-lg shadow-blue-500/10">View Album</button>
                                <a href="${f.url}" target="_blank" class="ml-4 text-[10px] font-bold text-slate-500 hover:text-white uppercase tracking-widest">Drive â†—</a>
                            </td>`;
                        tbody.appendChild(row);
                    });
                } catch(e) { 
                    tbody.innerHTML = `<tr><td colspan="2" class="p-10 text-center text-red-500 uppercase text-xs font-black">Connection Failed</td></tr>`;
                }
            }
        }

        function initGallery() {
            db.ref('photos/' + albumId).on('value', snap => {
                const view = document.getElementById('view-feed');
                view.innerHTML = "";
                snap.forEach(child => {
                    const data = child.val();
                    const div = document.createElement('div');
                    div.className = "aspect-square rounded-[2rem] overflow-hidden glass border border-white/5 hover:scale-[1.02] transition-all duration-500";
                    div.innerHTML = `<img src="${data.url}" class="w-full h-full object-cover" loading="lazy">`;
                    view.prepend(div);
                });
            });
        }

        document.getElementById('fileInput').onchange = async (e) => {
            const file = e.target.files[0]; if(!file || !albumId) return;
            document.getElementById('uploadToast').classList.remove('hidden');
            const reader = new FileReader(); reader.readAsDataURL(file);
            reader.onload = async () => {
                const base64 = reader.result.split(',')[1];
                await fetch(GAS_URL, { 
                    method: 'POST', 
                    mode: 'no-cors',
                    body: JSON.stringify({ base64, mimeType: file.type, fileName: file.name, albumId, userName: myName }) 
                });
                setTimeout(() => document.getElementById('uploadToast').classList.add('hidden'), 3000);
            };
        };
    </script>
</body>
</html>
